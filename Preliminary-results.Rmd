---
title: "Title of project"
author: "Anastasiia Revva, Juan Felipe Villamil Lozano, Aliona Hoste"
date: "17/11/2020"
output: html_document
---


### Introduction
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Objectives and hypotheses
Our main objectives are:

1. Explore the effects of salt stress on various morpho-physiological traits in different *E. sativa* accessions. 
2. Define the susceptible and resistant accessions
3. Identify traits the salt stress has the biggest influence on
4. Compare our results with the ones from the paper

Main hypothesis:

- Susceptible accessions have statistically different morpho-physiological traits compared to their control.
- The susceptible accessions have more morpho-physiological traits affected 


### Methods 
Firs we had to download and tidy the data.



####What have you done? And what did you use to do it? Step by step, so anyone could do it again by reading this part.

**
```{r Tidy_data_Nastya_experimenting.R, echo = TRUE, message=FALSE }
##Calling for the libraries to transform and tidy the data
library(dplyr)
library(tidyr)
##Downloading the data and transforming it 
#install.packages("ggplot2", dependencies = TRUE)
library(ggplot2)
#install.packages("readxl")
library(readxl)
# downloading excel sheet from internet and storing it into Excel object
Excel <- "https://dfzljdn9uc3pi.cloudfront.net/2020/9749/1/Raw_data_Afsar_et_al.%2C_2020-PeerJ_20.5.2020.xlsx"
# creating the folder datafile if it doesn't exist
D <- "data"
if (!dir.exists(D)) dir.create(D)
f <- paste0 (D, "/data.xlsx")
# downloading excel into the file datafile under the name data.xlsx
download.file(Excel, f, mode="wb")
# getting the name of excel sheets
excel.sheet <- excel_sheets(f)

# created a list with the 4 sheet table from excel 
X <- list()
for (i in excel.sheet){
  X[[i]] <- as.data.frame(read_xlsx(f,i))
}

# organise column names and fill the first 2 columns
for(i in names(X)){
  names(X[[i]])[1:3] <- c("Number", "Code", "Treat_Contr")
  X[[i]] <- X[[i]][-1,]
  #X[[i]] <- X[[i]][,-1] - deletion of numbers
  X[[i]] <- fill(X[[i]], 1:2)
}

#deleting the accession #7 and #16 from Morphological traits,
#Weight_ion, Chloro_c, because there is no data for that accessions in the Gas_e
#for(i in names(X)){
#  X[[i]] <- X[[i]][!X[[i]]$Code == "Es-7", ]
#  X[[i]] <- X[[i]][!X[[i]]$Code == "Es-16", ]
#}

#transforming columns data format 
for (i in seq_along(X)){
  X[[i]][2:3] <- lapply(X[[i]][2:3], as.factor)
  X[[i]][-(2:3)] <- lapply(X[[i]][-(2:3)], as.numeric)
}

# creating data frames from different xlsx sheets
Morpho_t <- X$`Morphological traits`
Weight_ion <- X$`FW DW RWC Ions EL`
Chloro_c <- X$`Chlorophyll content`
Gas_e <- X$`Gas Exchange parameters`

#Changing names of the columns for more convinient use
names(Morpho_t)[4:8] <- c('Shoot_Length', 
                          'Root_Length', 
                          'Plant_Height', 
                          'Number_Leaves', 
                          'Leaf_Area')
names(Chloro_c)[4] <- c('Chlorophyll_Content')
names(Weight_ion) [4:12] <- c('Fresh_Weight', 
                              'Dry_Weight', 
                              'RWC',
                              'Na',
                              'K', 
                              'Ca', 
                              'Mg', 
                              'K_Na', 
                              'Electrolyte_Leakage')
names(Gas_e) [4:7] <- c('Photsynthesis_Rate', 
                        'Intercellular_CO2', 
                        'Transpiration_Rate', 
                        'Stomatal_Conductance')

# adding NA cells into the missing 7th and 16th accession
# creating a data frame with the missing data first
Gas_e_miss <- data.frame (Number = rep(c(7, 16), each = 8),
                          Code = rep(c("Es-7", "Es-16"), each = 8),
                          Treat_Contr = rep(c("Treatment", "Control",
                                            "Treatment", "Control"), each = 4),
                          Photsynthesis_Rate = rep(NA, 16),
                          Intercellular_CO2 = rep(NA, 16),
                          Transpiration_Rate = rep(NA, 16),
                          Stomatal_Conductance = rep(NA, 16))
#changing the numbers in "Number" column
Gas_e$Number <- replace(Gas_e$Number, , rep(c(1:6, 8:15, 17:25), each = 8))
# adding NA cells into the missing 7th and 16th accession
if (!(is.element('Es-7', Gas_e$Code))) Gas_e <- rbind(Gas_e, Gas_e_miss)
#Sorting the variables according to Number
Gas_e <- Gas_e[order(Gas_e$Number),]
#Rewriting row names to correspond the ordered data
row.names(Gas_e) <- c(1:200)

# downloading data for the location of accessions
word <- "https://dfzljdn9uc3pi.cloudfront.net/2020/9749/1/Table_S1.docx"
w <- paste0(D, "/location.docx")
download.file(word, w, mode="wb")

#creating data frame for the location of accessions
#install.packages("docxtractr")
library(docxtractr)
Acc_loc <- docx_extract_all_tbls(read_docx(w, track_changes = NULL),
                                 guess_header = TRUE, preserve = FALSE,
                                 trim = TRUE)
Acc_loc <- as.data.frame(Acc_loc)
#removing m from Elevation column 
Acc_loc$Elevation <- sub(' m', '', Acc_loc$Elevation)
#transforming data in the accession_loc
Acc_loc[c(1,6)] <- lapply(Acc_loc[c(1,6)], as.numeric)
Acc_loc[-c(1,6)] <- lapply(Acc_loc[-c(1,6)], as.factor)
#In order to fit the length of this table to the length of the ultimate table
#we need to double all the rows
Acc_loc_double <- Acc_loc[rep(1:25, each = 2), ]

###
#experimenting with mapping the data
map <- data.frame(Code = Acc_loc$Code,
                  Latitude = Acc_loc$Latitude,
                  Longitude = Acc_loc$Longitude)
m <- ggplot(map, aes(x = Latitude,
                     y = Longitude))
m +
  geom_jitter() +
  geom_label(aes(label = Code))


# create summary table for morphological trait
a <- Morpho_t %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Shoot_Length = mean(Shoot_Length),
            Root_Length = mean(Root_Length), 
            Plant_Height = mean(Plant_Height), 
            Number_Leaves = mean(Number_Leaves), 
            Leaf_Area = mean(Leaf_Area))

# remove NA values from Weight_ion table
Weight_ion <- na.omit(Weight_ion)
#Create summary table for Weight ion
b <- Weight_ion %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Fresh_Weight= mean(Fresh_Weight),
            Dry_Weight= mean(Dry_Weight),
            RWC = mean(RWC),
            Na =mean(Na),
            K =mean(K),
            Ca =mean(Ca),
            Mg= mean(Mg),
            K_Na =mean(K_Na),
            Electrolyte_Leakage= mean(Electrolyte_Leakage))
#take only the columns number 4 to 12 to avoid repetition of number, code and treatment
b <- b[4:12] 

#Create summary table for Weight_ion
c <- Chloro_c %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Chlorophyll_Content = mean(Chlorophyll_Content))
#take only the columns number 4 to avoid repetition of number, code and treatment
c <- c[4]  

#Create summary table for Gas_e
d <- Gas_e %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Photsynthesis_Rate= mean(Photsynthesis_Rate),
            Intercellular_CO2= mean(Intercellular_CO2), 
            Transpiration_Rate= mean(Transpiration_Rate), 
            Stomatal_Conductance=mean(Stomatal_Conductance))
#take only the columns number 4 to 7 to avoid repetition of number, code and treatment
d <- d[4:7]

#add Acc_loc data to the table
e <- Acc_loc_double
e <- e[6]

#create data frame with all the summarized tables 
table <- data.frame(a, b, c, d, e)
```








We deleted accessions number 7 and 16 because last table 'Gas exchange parameters' does not contain informations


For calculating MFV, we used the same formula, however according to our method we used the min and max of the mean STI


### Results 
####Figures and tables with captions and description of what do they mean.


#####(1) Morphological traits
```{r morphological traits significant difference}
a1 <- aov(Shoot_Length ~ Treat_Contr, data = Morpho_t)
shapiro.test(a1$residuals)
#No normality

a2 <- aov(Root_Length ~ Treat_Contr, data = Morpho_t)
shapiro.test(a2$residuals)
#No normality

a3 <- aov(Plant_Height ~ Treat_Contr, data = Morpho_t)
shapiro.test(a3$residuals)
# No normality

a4 <- aov(Number_Leaves ~ Treat_Contr, data = Morpho_t)
shapiro.test(a4$residuals)
# No normality 

a5 <- aov(Leaf_Area ~ Treat_Contr, data = Morpho_t)
shapiro.test(a5$residuals)
# no normality 

for (i in names(Morpho_t[4:8])) { 
  boxplot(Morpho_t[, i] ~ Morpho_t$Treat_Contr, 
          ylab = names(Morpho_t[i]), 
          xlab = "Treatment"
  )
  print(kruskal.test(Morpho_t[, i] ~ Morpho_t$Treat_Contr))
}


```

There is a statistical difference between control and treatment for all morphological trait


- **Shoot length (SL)**: Shoot length is significantly reduced in the salt-stressed plants compared with the control (p < 0.05). The mean value for SL in salt-stressed plants is 1.10 ± 0.48 and 2.30 ± 0.56 for control plants. SL stress index of accessions varied from 16.73 to 89.12

- **Root length (RL)**: Root length is significantly reduced in the salt-stressed plants compared with the control (p < 0.05). The mean value for RL in salt-stressed plants is 0.98 ± 0.43 and 2.17 ± 0.42 for control plants. 
RL stress index of accessions varied from 15.91 to 73.53 

- **Plant height (PH)**: Plant height is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for PH in salt-stressed plants is 2.18 ± 0.76 and 4.43 ± 0.77 for control plants. 
PH stress index of accessions varied from 19.83 to 74.07 

- **Number of leaves(NL)**: Number of leaves is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for NL in salt-stressed plants is 2.43 ± 0.82 and 4.22 ± 0.78 for control plants. 
NL stress index of accessions varied from 28.00 to 94.12

- **Leaf area (LA)**: Leaf area is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for LA in salt-stressed plants is 0.03 ± 0.02 and 0.07 ± 0.03 for control plants. 
LA stress index of accessions varied from 75.95 to 100

##### (2) Biomass
```{r analysis for biomass}
#summary(STI)
```

- **Fresh weight (FW)**:
Fresh weight is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for FW in salt-stressed plants 96.22 ± 66.00 and 241.06 ± 164.75 for control plants.
FW stress index of accessions varied from 10.20 to 83.93


- **Dry weight (DW)**:
Dry weight is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for DW in salt-stressed plants is 6.26 ± 4.00 and 10.58 ± 6.89 for control plants.
DW stress index of accessions varied from 24.67 to 88.26

##### (3) RWC, EL and chlorophyll content
```{r analysis for RWC, EL and chlorophyll content}

```

- **Relative water content (RWC)**:
Relative water content is not significantly different in the salt-stressed plants compared with the control (p > 0.05).
The mean value for RWC in salt-stressed plants 92.77 X ± 2.65 and 92.10 ± 7.00 for control plants.


- **Electrolyte leakage (EL)**:
Electrolyte leakage is significantly increased in the salt-stressed plants compared with the control (p < 0.05).
The mean value for EL in salt-stressed plants is 60.60 ± 9.32 and 56.51 ± 6.48 for control plants.


- **Chlorophyll content (CC)**: 
Chlorophyll content is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for CC in salt-stressed plants is 14.06 ± 6.02 and 18.17 ± 4.79 for control plants.


##### (4) Mineral ion content
```{r analysis for mineral ion content}

```


- **Sodium (Na)**:
Sodium is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for Na in salt-stressed plants is 30.03 ± 8.84 and 13.60 ± 5.00 for control plants.


- **Potassium (K)**:
Potassium is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for K in salt-stressed plants is 19.72 ± 7.48 and 15.48 ± 6.09 for control plants.


- **K/Na ratio**:
K/Na ratio is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for K/Na ratio in salt-stressed plants is 0.67 ± 0.20 and 1.20 ± 0.36 for control plants.
X stress index of accessions varied from X to X

- **Calcium (Ca)**:
Calcium is significantly increased in the salt-stressed plants compared with the control (p < 0.05).
The mean value for Ca in salt-stressed plants is 9.12 ± 5.32 and 6.03 ± 2.60 for control plants.
X stress index of accessions varied from X to X

- **Magnesium (Mg)**:
Magnesium is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for Mg in salt-stressed plants is 4.37 ± 1.83 and 5.95 ± 2.85 for control plants.
X stress index of accessions varied from X to X


##### (5) Gas exchange attributes
```{r analysis for gas exchange attributes}

```

- **Photosynthesis rate (PR)**:
Photosynthesus rate is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for PR in salt-stressed plants is 1.95 ± 1.02 and 7.53 ± 4.84 for control plants.
X stress index of accessions varied from X to X

- **Intercellular CO2 (ICO2)**:
Intercellular CO2 is not significantly different in the salt-stressed plants compared with the control (p < 0.05).
The mean value for ICO2 in salt-stressed plants is 284.70 ± 42.57 and 281.20 ± 22.90 for control plants.
X stress index of accessions varied from X to X

- **Transpiration rate (TR)**:
Transpiration rate is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for TR in salt-stressed plants is 0.94 ± 0.48 and 2.57 ± 1.13 for control plants.
X stress index of accessions varied from X to X

- **Stomatal conductance (SC)**:
Stomatal conductance is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for SC in salt-stressed plants is 0.039 ± 0.02 and 0.15 ± 0.08 for control plants.
X stress index of accessions varied from X to X


```{r recap table for mean and median, echo=FALSE}
x <- data.frame(dplyr::filter(table, table$Treat_Contr=="Treatment"))
x <- x[-(1:3)]
y <- data.frame(dplyr::filter(table, table$Treat_Contr=="Control"))
y <- y[-(1:3)]

Mean_Treat <- x %>% 
  summarise(Mean_SL = mean(Shoot_Length),
            Mean_SL = mean(Root_Length), 
            Mean_PH = mean(Plant_Height), 
            Mean_NL = mean(Number_Leaves), 
            Mean_LA = mean(Leaf_Area),
            Mean_FW = mean(Fresh_Weight),
            Mean_DW = mean(Dry_Weight),
            Mean_RWC = mean(RWC),
            Mean_Na = mean(Na),
            Mean_K = mean(K),
            Mean_Ca = mean(Ca),
            Mean_Mg = mean(Mg),
            Mean_K_Na = mean(K_Na),
            Mean_EL = mean(Electrolyte_Leakage),
            Mean_CC = mean(Chlorophyll_Content),
            Mean_PR = mean (Photsynthesis_Rate, na.rm=T),
            Mean_ICO2 = mean(Intercellular_CO2, na.rm=T),
            Mean_TR = mean(Transpiration_Rate, na.rm=T),
            Mean_S = mean(Stomatal_Conductance, na.rm=T)) 
Mean_Control <- y %>% 
  summarise(Mean_SL = mean(Shoot_Length),
            Mean_SL = mean(Root_Length), 
            Mean_PH = mean(Plant_Height), 
            Mean_NL = mean(Number_Leaves), 
            Mean_LA = mean(Leaf_Area),
            Mean_FW = mean(Fresh_Weight),
            Mean_DW = mean(Dry_Weight),
            Mean_RWC = mean(RWC),
            Mean_Na = mean(Na),
            Mean_K = mean(K),
            Mean_Ca = mean(Ca),
            Mean_Mg = mean(Mg),
            Mean_K_Na = mean(K_Na),
            Mean_EL = mean(Electrolyte_Leakage),
            Mean_CC = mean(Chlorophyll_Content),
            Mean_PR = mean (Photsynthesis_Rate, na.rm=T),
            Mean_ICO2 = mean(Intercellular_CO2, na.rm=T),
            Mean_TR = mean(Transpiration_Rate, na.rm=T),
            Mean_S = mean(Stomatal_Conductance, na.rm=T)) 
Treatment <- c('Treatment','Control')
Means <- rbind(Mean_Treat, Mean_Control)
Means$Treat_Contr <- Treatment

Sd_Treatment <- x %>%
    summarise(SD_SL = sd(Shoot_Length),
            SD_RL = sd(Root_Length),
            SD_PH = sd(Plant_Height),
            SD_NL = sd(Number_Leaves),
            SD_LA = sd(Leaf_Area),
            SD_FW = sd(Fresh_Weight),
            SD_DW = sd(Dry_Weight),
            SD_RWC = sd(RWC),
            SD_Na = sd(Na),
            SD_K = sd(K),
            SD_Ca = sd(Ca),
            SD_Mg = sd(Mg),
            SD_K_NA = sd(K_Na),
            SD_EL = sd(Electrolyte_Leakage),
            SD_CC = sd(Chlorophyll_Content),
            SD_PR = sd (Photsynthesis_Rate, na.rm=T),
            SD_I_CO2 = sd(Intercellular_CO2, na.rm=T),
            SD_TR = sd(Transpiration_Rate, na.rm=T),
            SD_SC = sd(Stomatal_Conductance, na.rm=T))
Sd_Control <-   y %>%
  summarise(SD_SL = sd(Shoot_Length),
            SD_RL = sd(Root_Length),
            SD_PH = sd(Plant_Height),
            SD_NL = sd(Number_Leaves),
            SD_LA = sd(Leaf_Area),
            SD_FW = sd(Fresh_Weight),
            SD_DW = sd(Dry_Weight),
            SD_RWC = sd(RWC),
            SD_Na = sd(Na),
            SD_K = sd(K),
            SD_Ca = sd(Ca),
            SD_Mg = sd(Mg),
            SD_K_NA = sd(K_Na),
            SD_EL = sd(Electrolyte_Leakage),
            SD_CC = sd(Chlorophyll_Content),
            SD_PR = sd (Photsynthesis_Rate, na.rm=T),
            SD_I_CO2 = sd(Intercellular_CO2, na.rm=T),
            SD_TR = sd(Transpiration_Rate, na.rm=T),
            SD_SC = sd(Stomatal_Conductance, na.rm=T))
Treatment <- c('Treatment','Control')
SD <- rbind(Sd_Treatment,Sd_Control)
SD$Treat_Contr <- Treatment

knitr::kable(Means, caption = "Summary table for the mean of treated and control plants")
knitr::kable(SD, caption = "Summary table for the standard deviation (SD) of treated and control plants")
```



### Discussion 
####From your objectives.










### Conclusions


