---
title: "Salinity stress in Eruca sativa (E. sativa)"
author: "Anastasiia Revva, Juan Felipe Villamil Lozano, Aliona Hoste"
date: "17/11/2020"
output:
  html_document:
    code_folding: hide
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages and library required, message=FALSE}
#install.packages("ggpubr")
#install.packages("ggfortify")
library(ggpubr)
library(dplyr)
library(lattice)
library(survival)
library(Formula)
library(ggplot2)
library(Hmisc)
library(ggpubr)
library(tidyverse)
library(Hmisc)
library(corrplot)
library(dendextend)
library(ggfortify)
```


### Introduction
Under abiotic stress such as salinity, several morphological and physiological parameters of plants are affected. In function of their location, plants from the same species could exhibit difference tolerance to abiotic stress. In the study we will review, 25 accessions of E. sativa from different regions of Pakistan were analysed. Each accession have been separated into two groups receiving different treatment: first group is the control and the second underwent salt stress (150 mM NaCl) during two weeks. Following that 19 morpho-physiological traits were measured.

The data was obtained from the paper **"Evaluation of salt tolerance in *Eruca sativa* accessions based on morpho-physiological traits"**
(Afsar et. al 2020)
https://peerj.com/articles/9749/

### Objectives and hypotheses
Our main objectives are:

1. Explore the effects of salt stress on various morpho-physiological traits in different *E. sativa* accessions. 
2. Define the susceptible and resistant accessions
3. Identify traits the salt stress has the biggest influence on
4. Compare our results with the ones from the paper

Main hypothesis:

- Susceptible accessions have statistically different morpho-physiological traits compared to their control.
- The susceptible accessions have more morpho-physiological traits affected 


### Methods 
####What have you done? And what did you use to do it? Step by step, so anyone could do it again by reading this part.
First we had to download and tidy the data. Once we have the table containing the mean values of variables for each accessions and treatments, we tested the normality of variables with shapiro.test. Then, we analysed if there is a significant difference between salt-treated and control plants for each variable. If there was normality, the analysis was performed with anova (only one variable), otherwise we used kruskal-Wallis test.

Additionaly, we did a summary table for the mean and sd of treated and control plant.

We created another table with data converted into salt tolerance index (STI): ratio of treated plant values to control.

Then, we computed the MVF table using the formula provided in the article: **$Xp=[(X−Xmin)/(Xmax−Xmin)]×100%$**. For the traits inversely related to salt tolerance (Electrolyte leakage, Na, K, Ca) we used the second formula: **$Xp=[1−(X−Xmin)/(Xmax−Xmin)]×100%$**
For calculating MFV, we used the same formula, however we used the min and max of the mean STI.


We performed the Principal Component Analysis on the MFV values of all the variables, except for RWC and ICO2 because they did not show significant difference between treatment and control. We used 8 highest ranked variables from the results: PH, SL, RL, NL, DW, FW, LA, K_Na. 

We computed the mean of MFV from MFV values of the variables above. With the results, we ranked the accessions from highly tolerant to highly sensitive. 


We started pearson correlation but we still need to finish it. We started doing peason correlation using MFV values which results are very similar to the article. But we also computed on the raw data because we think it has more sence.


We still need to make the dendogram, add map with accession and check for correlation between altitude and MFV ranking. 



### Results 
#####(Figures and tables with captions and description of what do they mean.)

#### (1) Tidying of data
```{r Tidy_data.R, message=FALSE}
##Calling for the libraries to transform and tidy the data
library(dplyr)
library(tidyr)
##Downloading the data and transforming it 
#install.packages("ggplot2", dependencies = TRUE)
library(ggplot2)
#install.packages("readxl")
library(readxl)
# downloading excel sheet from internet and storing it into Excel object
Excel <- "https://dfzljdn9uc3pi.cloudfront.net/2020/9749/1/Raw_data_Afsar_et_al.%2C_2020-PeerJ_20.5.2020.xlsx"
# creating the folder datafile if it doesn't exist
D <- "data"
if (!dir.exists(D)) dir.create(D)
f <- paste0 (D, "/data.xlsx")
# downloading excel into the file datafile under the name data.xlsx
download.file(Excel, f, mode="wb")
# getting the name of excel sheets
excel.sheet <- excel_sheets(f)

# created a list with the 4 sheet table from excel 
X <- list()
for (i in excel.sheet){
  X[[i]] <- as.data.frame(read_xlsx(f,i))
}

# organise column names and fill the first 2 columns
for(i in names(X)){
  names(X[[i]])[1:3] <- c("Number", "Code", "Treat_Contr")
  X[[i]] <- X[[i]][-1,]
  #X[[i]] <- X[[i]][,-1] - deletion of numbers
  X[[i]] <- fill(X[[i]], 1:2)
}

#deleting the accession #7 and #16 from Morphological traits,
#Weight_ion, Chloro_c, because there is no data for that accessions in the Gas_e
#for(i in names(X)){
#  X[[i]] <- X[[i]][!X[[i]]$Code == "Es-7", ]
#  X[[i]] <- X[[i]][!X[[i]]$Code == "Es-16", ]
#}

#transforming columns data format 
for (i in seq_along(X)){
  X[[i]][2:3] <- lapply(X[[i]][2:3], as.factor)
  X[[i]][-(2:3)] <- lapply(X[[i]][-(2:3)], as.numeric)
}

# creating data frames from different xlsx sheets
Morpho_t <- X$`Morphological traits`
Weight_ion <- X$`FW DW RWC Ions EL`
Chloro_c <- X$`Chlorophyll content`
Gas_e <- X$`Gas Exchange parameters`

#Changing names of the columns for more convinient use
names(Morpho_t)[4:8] <- c('Shoot_Length', 
                          'Root_Length', 
                          'Plant_Height', 
                          'Number_Leaves', 
                          'Leaf_Area')
names(Chloro_c)[4] <- c('Chlorophyll_Content')
names(Weight_ion) [4:12] <- c('Fresh_Weight', 
                              'Dry_Weight', 
                              'RWC',
                              'Na',
                              'K', 
                              'Ca', 
                              'Mg', 
                              'K_Na', 
                              'Electrolyte_Leakage')
names(Gas_e) [4:7] <- c('Photsynthesis_Rate', 
                        'Intercellular_CO2', 
                        'Transpiration_Rate', 
                        'Stomatal_Conductance')

# adding NA cells into the missing 7th and 16th accession
# creating a data frame with the missing data first
Gas_e_miss <- data.frame (Number = rep(c(7, 16), each = 8),
                          Code = rep(c("Es-7", "Es-16"), each = 8),
                          Treat_Contr = rep(c("Treatment", "Control",
                                            "Treatment", "Control"), each = 4),
                          Photsynthesis_Rate = rep(NA, 16),
                          Intercellular_CO2 = rep(NA, 16),
                          Transpiration_Rate = rep(NA, 16),
                          Stomatal_Conductance = rep(NA, 16))
#changing the numbers in "Number" column
Gas_e$Number <- replace(Gas_e$Number, , rep(c(1:6, 8:15, 17:25), each = 8))
# adding NA cells into the missing 7th and 16th accession
if (!(is.element('Es-7', Gas_e$Code))) Gas_e <- rbind(Gas_e, Gas_e_miss)
#Sorting the variables according to Number
Gas_e <- Gas_e[order(Gas_e$Number),]
#Rewriting row names to correspond the ordered data
row.names(Gas_e) <- c(1:200)

# downloading data for the location of accessions
word <- "https://dfzljdn9uc3pi.cloudfront.net/2020/9749/1/Table_S1.docx"
w <- paste0(D, "/location.docx")
download.file(word, w, mode="wb")

#creating data frame for the location of accessions
#install.packages("docxtractr")
library(docxtractr)
Acc_loc <- docx_extract_all_tbls(read_docx(w, track_changes = NULL),
                                 guess_header = TRUE, preserve = FALSE,
                                 trim = TRUE)
Acc_loc <- as.data.frame(Acc_loc)
#removing m from Elevation column 
Acc_loc$Elevation <- sub(' m', '', Acc_loc$Elevation)
#transforming data in the accession_loc
Acc_loc[c(1,6)] <- lapply(Acc_loc[c(1,6)], as.numeric)
Acc_loc[-c(1,6)] <- lapply(Acc_loc[-c(1,6)], as.factor)
#In order to fit the length of this table to the length of the ultimate table
#we need to double all the rows
Acc_loc_double <- Acc_loc[rep(1:25, each = 2), ]

###
#experimenting with mapping the data
#map <- data.frame(Code = Acc_loc$Code,
#                  Latitude = Acc_loc$Latitude,
#                  Longitude = Acc_loc$Longitude)
#m <- ggplot(map, aes(x = Latitude,
#                     y = Longitude))
#m +
#  geom_jitter() +
#  geom_label(aes(label = Code))


# create summary table for morphological trait
a <- Morpho_t %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Shoot_Length = mean(Shoot_Length),
            Root_Length = mean(Root_Length), 
            Plant_Height = mean(Plant_Height), 
            Number_Leaves = mean(Number_Leaves), 
            Leaf_Area = mean(Leaf_Area))

# remove NA values from Weight_ion table
Weight_ion <- na.omit(Weight_ion)
#Create summary table for Weight ion
b <- Weight_ion %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Fresh_Weight= mean(Fresh_Weight),
            Dry_Weight= mean(Dry_Weight),
            RWC = mean(RWC),
            Na =mean(Na),
            K =mean(K),
            Ca =mean(Ca),
            Mg= mean(Mg),
            K_Na =mean(K_Na),
            Electrolyte_Leakage= mean(Electrolyte_Leakage))
#take only the columns number 4 to 12 to avoid repetition of number, code and treatment
b <- b[4:12] 

#Create summary table for Weight_ion
c <- Chloro_c %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Chlorophyll_Content = mean(Chlorophyll_Content))
#take only the columns number 4 to avoid repetition of number, code and treatment
c <- c[4]  

#Create summary table for Gas_e
d <- Gas_e %>% 
  group_by(Number, Code, Treat_Contr) %>% 
  summarise(Photsynthesis_Rate= mean(Photsynthesis_Rate),
            Intercellular_CO2= mean(Intercellular_CO2), 
            Transpiration_Rate= mean(Transpiration_Rate), 
            Stomatal_Conductance=mean(Stomatal_Conductance))
#take only the columns number 4 to 7 to avoid repetition of number, code and treatment
d <- d[4:7]

#add Acc_loc data to the table
e <- Acc_loc_double
e <- e[6]

#create data frame with all the summarized tables 
table <- data.frame(a, b, c, d, e)

```

```{r, tidy table}
knitr::kable(table, caption = "Table 1. Mean values of variables for each accessions and treatments", align="c" , digits = round(2))
```



##### (2) Statistical analysis on variables 
##### i. Morphological traits
There is a statistical difference between control and treatment for all morphological trait

- **Shoot length (SL)**: Shoot length is significantly reduced in the salt-stressed plants compared with the control (p < 0.05). The mean value for SL in salt-stressed plants is 1.10 ± 0.48 and 2.30 ± 0.56 for control plants. SL stress index of accessions varied from 16.73 to 89.12

- **Root length (RL)**: Root length is significantly reduced in the salt-stressed plants compared with the control (p < 0.05). The mean value for RL in salt-stressed plants is 0.98 ± 0.43 and 2.17 ± 0.42 for control plants. 
RL stress index of accessions varied from 15.91 to 73.53 

- **Plant height (PH)**: Plant height is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for PH in salt-stressed plants is 2.18 ± 0.76 and 4.43 ± 0.77 for control plants. 
PH stress index of accessions varied from 19.83 to 74.07 

- **Number of leaves(NL)**: Number of leaves is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for NL in salt-stressed plants is 2.43 ± 0.82 and 4.22 ± 0.78 for control plants. 
NL stress index of accessions varied from 28.00 to 94.12

- **Leaf area (LA)**: Leaf area is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for LA in salt-stressed plants is 0.03 ± 0.02 and 0.07 ± 0.03 for control plants. 
LA stress index of accessions varied from 75.95 to 100

```{r morphological traits normality test}
spm <-  numeric()
nor_spm <- c()
for(i in names(Morpho_t[4:8])) { 
  an1 <- aov(Morpho_t[, i] ~ Morpho_t$Treat_Contr)
  spm[i] <- shapiro.test(an1$residuals)$p.value
  nor_spm <- c(nor_spm, ifelse (spm[i] <= 0.05, "False", "True"))
}
spm_table <- data.frame ("P-value" = spm, "Normality" = nor_spm)

knitr::kable(spm_table, caption = "Table 2. Shapiro test results for morphological traits", align="c")
```

```{r morphological traits significant difference, fig.cap ="blabla"}
#install.packages("ggpubr")
library(ggpubr)

for (i in names(Morpho_t[4:8])) {
  bmorpho <- ggboxplot(Morpho_t, 
                 x = "Treat_Contr",
                 y = names(Morpho_t[i]), 
                 color = names(Morpho_t[3]),
                 palette = c("blue", "red"),
                 add = "jitter") + 
    stat_compare_means(data = Morpho_t, method = "kruskal.test", label.x.npc = "center",
                       label.y.npc = "top")
  print(bmorpho)
} 
```

##### ii) Biomass
- **Fresh weight (FW)**:
Fresh weight is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for FW in salt-stressed plants 96.22 ± 66.00 and 241.06 ± 164.75 for control plants.
FW stress index of accessions varied from 10.20 to 83.93


- **Dry weight (DW)**:
Dry weight is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for DW in salt-stressed plants is 6.26 ± 4.00 and 10.58 ± 6.89 for control plants.
DW stress index of accessions varied from 24.67 to 88.26

```{r Biomass normality test}
spb <- numeric()
nor_spb <- c()
for(i in names(Weight_ion[4:5])) { 
  an2 <- aov(Weight_ion[, i] ~ Weight_ion$Treat_Contr)
  spb[i] <- shapiro.test(an2$residuals)$p.value
  nor_spb <- c(nor_spb, ifelse (spb[i] <= 0.05, "False", "True"))
}
spb_table <- data.frame ("P-value" = spb, "Normality" = nor_spb)



knitr::kable(spb_table, caption = "Table 3. Shapiro test results for biomass", align="c")
```

```{r Biomass significant difference}
for (i in names(Weight_ion[c(6,12)])) {
  bwei2 <- ggboxplot(Weight_ion, 
                 x = "Treat_Contr",
                 y = names(Weight_ion[i]), 
                 color = names(Weight_ion[3]),
                 palette = c("blue", "red"),
                 add = "jitter") + 
    stat_compare_means(data = Weight_ion, method = "kruskal.test", label.x.npc = "center",
                       label.y.npc = "top")
  print(bwei2)
} 


```


##### iii) RWC, EL and chlorophyll content
- **Relative water content (RWC)**:
Relative water content is not significantly different in the salt-stressed plants compared with the control (p > 0.05).
The mean value for RWC in salt-stressed plants 92.77 X ± 2.65 and 92.10 ± 7.00 for control plants.


- **Electrolyte leakage (EL)**:
Electrolyte leakage is significantly increased in the salt-stressed plants compared with the control (p < 0.05).
The mean value for EL in salt-stressed plants is 60.60 ± 9.32 and 56.51 ± 6.48 for control plants.


- **Chlorophyll content (CC)**: 
Chlorophyll content is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for CC in salt-stressed plants is 14.06 ± 6.02 and 18.17 ± 4.79 for control plants.
```{r RWC, EL and chlorophyll content normality test}
spe <- numeric()
nor_spe <- c()
for(i in names(Weight_ion[c(6,12)])) { 
  an3 <- aov(Weight_ion[, i] ~ Weight_ion$Treat_Contr)
  spe[i] <- shapiro.test(an3$residuals)$p.value
  nor_spe <- c(nor_spe, ifelse (spe[i] <= 0.05, "False", "True"))
}
spe_table <- data.frame ("P-value" = spe, "Normality" = nor_spe)

nor_spc <- c()
an4 <- aov(Chloro_c$Chlorophyll_Content ~ Chloro_c$Treat_Contr)
spc <- shapiro.test(an4$residuals)$p.value
nor_spc <- c(nor_spc, ifelse (spc <= 0.05, "False", "True"))

spc_table <- data.frame ("P-value" = spc, "Normality" = nor_spc)
row.names(spc_table) <- "Chlorophyll_Content"

spec_table <- dplyr::bind_rows(spe_table, spc_table)


knitr::kable(spec_table, caption = "Table 4. Shapiro test results for RWC, EL and chlorophyll content", align="c")
```

```{r RWC, EL and chlorophyll content significant difference}
for (i in names(Weight_ion[7:11])) {
  bwei3 <- ggboxplot(Weight_ion, 
                 x = "Treat_Contr",
                 y = names(Weight_ion[i]), 
                 color = names(Weight_ion[3]),
                 palette = c("blue", "red"),
                 add = "jitter") + 
    stat_compare_means(data = Weight_ion, method = "kruskal.test", label.x.npc = "center",
                       label.y.npc = "top")
  print(bwei3)
} 

bchlo <- ggboxplot(Chloro_c, 
                 x = "Treat_Contr",
                 y = "Chlorophyll_Content", 
                 color = names(Chloro_c[3]),
                 palette = c("blue", "red"),
                 add = "jitter") 
bchlo + stat_compare_means(data = Chloro_c, method = "kruskal.test", label.x.npc = "center",
                       label.y.npc = "top")
```





##### iv) Mineral ion content
- **Sodium (Na)**:
Sodium is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for Na in salt-stressed plants is 30.03 ± 8.84 and 13.60 ± 5.00 for control plants.


- **Potassium (K)**:
Potassium is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for K in salt-stressed plants is 19.72 ± 7.48 and 15.48 ± 6.09 for control plants.


- **Calcium (Ca)**:
Calcium is significantly increased in the salt-stressed plants compared with the control (p < 0.05).
The mean value for Ca in salt-stressed plants is 9.12 ± 5.32 and 6.03 ± 2.60 for control plants.


- **Magnesium (Mg)**:
Magnesium is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for Mg in salt-stressed plants is 4.37 ± 1.83 and 5.95 ± 2.85 for control plants.


- **K/Na ratio**:
K/Na ratio is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for K/Na ratio in salt-stressed plants is 0.67 ± 0.20 and 1.20 ± 0.36 for control plants.

```{r Mineral ion content normality test}
spw <- numeric()
nor_spw <- c()
for(i in names(Weight_ion[7:11])) { 
  an5 <- aov(Weight_ion[, i] ~ Weight_ion$Treat_Contr)
  spw[i] <- shapiro.test(an5$residuals)$p.value
  nor_spw <- c(nor_spw, ifelse (spw[i] <= 0.05, "False", "True"))
}
spw_table <- data.frame ("P-value" = spw, "Normality" = nor_spw)

knitr::kable(spw_table, caption = "Table 5. Shapiro test results for Mineral ion content", align="c")
```

```{r Mineral ion content significant difference}
for (i in names(Weight_ion[7:11])) {
  bwei3 <- ggboxplot(Weight_ion, 
                 x = "Treat_Contr",
                 y = names(Weight_ion[i]), 
                 color = names(Weight_ion[3]),
                 palette = c("blue", "red"),
                 add = "jitter") + 
    stat_compare_means(data = Weight_ion, method = "kruskal.test", label.x.npc = "center",
                       label.y.npc = "top")
  print(bwei3)
} 
```






##### v) Gas exchange attributes
- **Photosynthesis rate (PR)**:
Photosynthesus rate is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for PR in salt-stressed plants is 1.95 ± 1.02 and 7.53 ± 4.84 for control plants.

- **Intercellular CO2 (ICO2)**:
Intercellular CO2 is not significantly different in the salt-stressed plants compared with the control (p < 0.05).
The mean value for ICO2 in salt-stressed plants is 284.70 ± 42.57 and 281.20 ± 22.90 for control plants.

- **Transpiration rate (TR)**:
Transpiration rate is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for TR in salt-stressed plants is 0.94 ± 0.48 and 2.57 ± 1.13 for control plants.

- **Stomatal conductance (SC)**:
Stomatal conductance is significantly reduced in the salt-stressed plants compared with the control (p < 0.05).
The mean value for SC in salt-stressed plants is 0.039 ± 0.02 and 0.15 ± 0.08 for control plants.

```{r Gas exchange attributes normality test}
spg <- numeric()
nor_spg <- c()
for (i in names(Gas_e[c(4,5,6:7)])) { 
  an6 <- aov(Gas_e[, i] ~ Gas_e$Treat_Contr)
  spg[i] <- shapiro.test(an6$residuals)$p.value
  nor_spg <- c(nor_spg, ifelse (spg[i] <= 0.05, "False", "True"))
}

spg_table <- data.frame ("P-value" = spg, "Normality" = nor_spg)

knitr::kable(spg_table, caption = "Table 6. Shapiro test results for gas exchange attributes", align="c")
```

```{r Gas exchange attributes significant difference}
Gas_e_withoutNA <- na.omit(Gas_e)
for (i in names(Gas_e_withoutNA[c(4,6:7)])) {
  bgas <- ggboxplot(Gas_e_withoutNA, 
                 x = "Treat_Contr",
                 y = names(Gas_e_withoutNA[i]), 
                 color = names(Gas_e_withoutNA[3]),
                 palette = c("blue", "red"),
                 add = "jitter") + 
    stat_compare_means(data = Gas_e_withoutNA, method = "kruskal.test", label.x.npc = "center",label.y.npc = "top")
print(bgas)} 

banova <- ggboxplot(Gas_e_withoutNA,
          x="Treat_Contr", 
          y= "Intercellular_CO2",
          color = names(Gas_e_withoutNA[3]),
          palette = c("blue", "red"),
          add = "jitter") 
banova  +   stat_compare_means(method = "anova")  
```




```{r recap table for mean and median}
x <- data.frame(dplyr::filter(table, table$Treat_Contr=="Treatment"))
x <- x[-(1:3)]
y <- data.frame(dplyr::filter(table, table$Treat_Contr=="Control"))
y <- y[-(1:3)]

Mean_Treat <- x %>% 
  summarise(Mean_SL = mean(Shoot_Length),
            Mean_SL = mean(Root_Length), 
            Mean_PH = mean(Plant_Height), 
            Mean_NL = mean(Number_Leaves), 
            Mean_LA = mean(Leaf_Area),
            Mean_FW = mean(Fresh_Weight),
            Mean_DW = mean(Dry_Weight),
            Mean_RWC = mean(RWC),
            Mean_Na = mean(Na),
            Mean_K = mean(K),
            Mean_Ca = mean(Ca),
            Mean_Mg = mean(Mg),
            Mean_K_Na = mean(K_Na),
            Mean_EL = mean(Electrolyte_Leakage),
            Mean_CC = mean(Chlorophyll_Content),
            Mean_PR = mean (Photsynthesis_Rate, na.rm=T),
            Mean_ICO2 = mean(Intercellular_CO2, na.rm=T),
            Mean_TR = mean(Transpiration_Rate, na.rm=T),
            Mean_S = mean(Stomatal_Conductance, na.rm=T)) 
Mean_Control <- y %>% 
  summarise(Mean_SL = mean(Shoot_Length),
            Mean_SL = mean(Root_Length), 
            Mean_PH = mean(Plant_Height), 
            Mean_NL = mean(Number_Leaves), 
            Mean_LA = mean(Leaf_Area),
            Mean_FW = mean(Fresh_Weight),
            Mean_DW = mean(Dry_Weight),
            Mean_RWC = mean(RWC),
            Mean_Na = mean(Na),
            Mean_K = mean(K),
            Mean_Ca = mean(Ca),
            Mean_Mg = mean(Mg),
            Mean_K_Na = mean(K_Na),
            Mean_EL = mean(Electrolyte_Leakage),
            Mean_CC = mean(Chlorophyll_Content),
            Mean_PR = mean (Photsynthesis_Rate, na.rm=T),
            Mean_ICO2 = mean(Intercellular_CO2, na.rm=T),
            Mean_TR = mean(Transpiration_Rate, na.rm=T),
            Mean_S = mean(Stomatal_Conductance, na.rm=T)) 
Treatment <- c('Treatment','Control')
Means <- rbind(Mean_Treat, Mean_Control)
Means$Treat_Contr <- Treatment

Sd_Treatment <- x %>%
    summarise(SD_SL = sd(Shoot_Length),
            SD_RL = sd(Root_Length),
            SD_PH = sd(Plant_Height),
            SD_NL = sd(Number_Leaves),
            SD_LA = sd(Leaf_Area),
            SD_FW = sd(Fresh_Weight),
            SD_DW = sd(Dry_Weight),
            SD_RWC = sd(RWC),
            SD_Na = sd(Na),
            SD_K = sd(K),
            SD_Ca = sd(Ca),
            SD_Mg = sd(Mg),
            SD_K_NA = sd(K_Na),
            SD_EL = sd(Electrolyte_Leakage),
            SD_CC = sd(Chlorophyll_Content),
            SD_PR = sd (Photsynthesis_Rate, na.rm=T),
            SD_I_CO2 = sd(Intercellular_CO2, na.rm=T),
            SD_TR = sd(Transpiration_Rate, na.rm=T),
            SD_SC = sd(Stomatal_Conductance, na.rm=T))
Sd_Control <-   y %>%
  summarise(SD_SL = sd(Shoot_Length),
            SD_RL = sd(Root_Length),
            SD_PH = sd(Plant_Height),
            SD_NL = sd(Number_Leaves),
            SD_LA = sd(Leaf_Area),
            SD_FW = sd(Fresh_Weight),
            SD_DW = sd(Dry_Weight),
            SD_RWC = sd(RWC),
            SD_Na = sd(Na),
            SD_K = sd(K),
            SD_Ca = sd(Ca),
            SD_Mg = sd(Mg),
            SD_K_NA = sd(K_Na),
            SD_EL = sd(Electrolyte_Leakage),
            SD_CC = sd(Chlorophyll_Content),
            SD_PR = sd (Photsynthesis_Rate, na.rm=T),
            SD_I_CO2 = sd(Intercellular_CO2, na.rm=T),
            SD_TR = sd(Transpiration_Rate, na.rm=T),
            SD_SC = sd(Stomatal_Conductance, na.rm=T))
Treatment <- c('Treatment','Control')
SD <- rbind(Sd_Treatment,Sd_Control)
SD$Treat_Contr <- Treatment

knitr::kable(Means, caption = "Table 7. Summary table for the mean of treated and control plants")
knitr::kable(SD, caption = "Table 8. Summary table for the standard deviation (SD) of treated and control plants")
```

##### (3) Pearson correlation 
```{r Pearson test, fig.cap = "Figure 3.1. Pearson correlation table for all variables. X represent non-significative correlation (p-value > 0.05)"}
# table with all the variables but without 3 first columns
all_data <- na.omit(table[4:23])

res1 <- cor.mtest(all_data, conf.level = .95)
M1 <-cor(all_data)
corrplot(M1, p.mat = res1$p, sig.level = .05, type = "lower")

```


#### (4) Salt tolerance index (STI)
```{r STI}
x <- data.frame(dplyr::filter(table, table$Treat_Contr=="Treatment"))
x <- x[-(1:3)]
y <- data.frame(dplyr::filter(table, table$Treat_Contr=="Control"))
y <- y[-(1:3)]


#salt tolerance index for morphological traits
STI_Shoot_Length <- x[1]/y[1]
STI_Root_Length <- x[2]/y[2]
STI_Plant_Height <- x[3]/y[3]
STI_Number_Leaves <- x[4]/y[4]
STI_Leaf_Area <- x[5]/y[5]

#trying to make a for loop
#STI1 <- data.frame()
#vecteur <- c()
#for (i in names(x)){
#  for (j in 1:4){
#    name <- paste("STI", i ,sep = "_" )
#    name <- x[j]/x[j]
#    vecteur <- c(vecteur, name)}}

#salt tolerance index for biomass
STI_Fresh_Weight <- x[6]/y[6]
STI_Dry_Weight <- x[7]/y[7]

#salt tolerance index for RWC, EL and Chlorophyll content
STI_Relative_water_content  <- x[8]/y[8]
names(STI_Relative_water_content)[1] <- "Relative_water_content" # change the name of the column of the data
STI_Electrolyte_Leakage  <- x[14]/y[14]
STI_Chlorophyll_Content <- x[15]/y[15]

# salt tolerance index for Mineral ion content
STI_Na <- x[9]/y[9]
STI_K <- x[10]/y[10]
STI_Ca <- x[11]/y[11]
STI_Mg <- x[12]/y[12]
STI_K_Na <- x[13]/y[13]

# salt tolerance index for Gas exchange attributes
STI_Photosynthesis_rate <- x[16]/y[16]
STI_Intercellular_CO2 <- x[17]/y[17]
STI_Transpiration_Rate <- x[18]/y[18]
STI_Stomatal_Conductance <- x[19]/y[19]

STI <- data.frame(STI_Shoot_Length,
                  STI_Root_Length, 
                  STI_Plant_Height, 
                  STI_Number_Leaves, 
                  STI_Leaf_Area, 
                  STI_Fresh_Weight, 
                  STI_Dry_Weight,
                  STI_Relative_water_content, 
                  STI_Electrolyte_Leakage,
                  STI_Na,
                  STI_K,
                  STI_Ca,
                  STI_Mg,
                  STI_K_Na,
                  STI_Chlorophyll_Content,
                  STI_Photosynthesis_rate,
                  STI_Intercellular_CO2,
                  STI_Transpiration_Rate,
                  STI_Stomatal_Conductance)

knitr::kable(STI, caption = "Table 4.1. Summary table for salt tolerance index")
```


#### (5) Membership function value (MFV) 
```{r MFV}
#Membership function value 
# 1-results for the traits inversely related to salt tolerance: which are electrolyte leakage, Na, K and Ca
MFV <- STI %>%
  mutate(SL = (STI$Shoot_Length - min(STI$Shoot_Length))/(max(STI$Shoot_Length)- min(STI$Shoot_Length)),
         RL = (STI$Root_Length - min(STI$Root_Length))/(max(STI$Root_Length)- min(STI$Root_Length)),
         PH = (STI$Plant_Height - min(STI$Plant_Height))/(max(STI$Plant_Height)- min(STI$Plant_Height)),
         NL = (STI$Number_Leaves - min(STI$Number_Leaves))/(max(STI$Number_Leaves)- min(STI$Number_Leaves)),
         LA = (STI$Leaf_Area - min(STI$Leaf_Area))/(max(STI$Leaf_Area)- min(STI$Leaf_Area)),
         FW = (STI$Fresh_Weight - min(STI$Fresh_Weight))/(max(STI$Fresh_Weight)- min(STI$Fresh_Weight)) ,
         DW = (STI$Dry_Weight - min(STI$Dry_Weight))/(max(STI$Dry_Weight)- min(STI$Dry_Weight)),
         RWC = (STI$Relative_water_content - min(STI$Relative_water_content))/(max(STI$Relative_water_content)- min(STI$Relative_water_content)),
         EL = 1-(STI$Electrolyte_Leakage - min(STI$Electrolyte_Leakage))/(max(STI$Electrolyte_Leakage)- min(STI$Electrolyte_Leakage)),
         CC = (STI$Chlorophyll_Content - min(STI$Chlorophyll_Content))/(max(STI$Chlorophyll_Content)- min(STI$Chlorophyll_Content)),
         Na = 1-(STI$Na - min(STI$Na))/(max(STI$Na)- min(STI$Na)),
         K = 1-(STI$K - min(STI$K))/(max(STI$K)- min(STI$K)),
         Ca =1- (STI$Ca - min(STI$Ca))/(max(STI$Ca)- min(STI$Ca)),
         Mg=(STI$Mg - min(STI$Mg))/(max(STI$Mg)- min(STI$Mg)),
         K_Na= (STI$K_Na - min(STI$K_Na))/(max(STI$K_Na)- min(STI$K_Na)),
         PR= (STI$Photsynthesis_Rate - min(STI$Photsynthesis_Rate, na.rm=T))/(max(STI$Photsynthesis_Rate, na.rm=T)- min(STI$Photsynthesis_Rate, na.rm=T)),
         ICO2= (STI$Intercellular_CO2 - min(STI$Intercellular_CO2, na.rm=T))/(max(STI$Intercellular_CO2, na.rm=T)- min(STI$Intercellular_CO2, na.rm=T)),
         TR= (STI$Transpiration_Rate - min(STI$Transpiration_Rate, na.rm=T))/(max(STI$Transpiration_Rate, na.rm=T)- min(STI$Transpiration_Rate, na.rm=T)),
         SC= (STI$Stomatal_Conductance - min(STI$Stomatal_Conductance, na.rm=T))/(max(STI$Stomatal_Conductance, na.rm=T)- min(STI$Stomatal_Conductance, na.rm=T)))%>%
  select(SL, RL, PH, NL, LA, FW, DW, RWC, EL, CC, Na, K, Ca, Mg, K_Na, PR, ICO2, TR, SC)

knitr::kable(MFV, caption = "Table 5.1. MFV table based on STI", align="c")
```

#### (6) Principal component analysis (PCA)
```{r PCA}
####------PCA on MFV-------###

#doing the PCA, adding the scaling into the function
MFV_salt.pca <- prcomp((na.omit(MFV[-c(8, 17, 20)])), scale. = TRUE)
#results of the PCA
MFV_salt.pca$sdev
summary(MFV_salt.pca)
#check, if the sums equal to quantity of observations (=17)
sum((MFV_salt.pca$sdev)^2)
#plotting the results in order to evaluate the principal components
MFV_plot <- screeplot(MFV_salt.pca,
                      npcs = length(MFV_salt.pca$sdev),
                      type = "lines")
#plotting the results of the PCA
library(ggplot2)
#install.packages("ggfortify")
library(ggfortify)
#making a scatterplot of PC1 and PC2
#creating data.frame for data labels in future plot
MFV_labels <- data.frame(Acc_loc$Elevation[-c(7, 16)])
row.names(MFV_labels) <- paste0("Ess-", c(1:6, 8:15, 17:25))
#creating the plot
MFV_pc12 <- autoplot(MFV_salt.pca, loadings = TRUE, loadings.colour = 'blue',
         loadings.label = TRUE, loadings.label.size = 5,                #plotting the variables
         data = MFV_labels, shape = FALSE, label.size = 3,              #plotting the accessions
         frame = TRUE)                                                  #plotting the frame (to see if there are any groups)
MFV_pc12 + ggtitle("Scatterplot of PC1 and PC2")                            #adding the title

#putting absolute values of the loading scores from PCA1 into a vector
MFV_loading_scores <- abs(MFV_salt.pca$rotation[,1])
#ranking the variables
MFV_var_scores_ranked <- sort(MFV_loading_scores, decreasing = TRUE)
# We used 8 highest ranked variables to include in the final MFV-based ranking
# of salt tolerance accessions
print(MFV_var_scores_ranked) # Result from PCA analysis (from PCA_analysis.R)
```



#### (7) MFV Ranking 
```{r MFV ranking}
MFV <- MFV %>%
  mutate(Mean = rowMeans(MFV[c(1:7, 15)], na.rm=T))%>%
  select(SL, RL, PH, NL, LA, FW, DW, RWC, EL, CC, Na, K, Ca, Mg, K_Na, PR, ICO2, TR, SC, Mean)

MFV_Ranked <- MFV[order(-MFV$Mean),]
MFV_Ranked <- MFV_Ranked[20]
MFV_Ranked$Category <- c("Highly tolerant",(rep("Tolerant", 5)), (rep("Moderately tolerant", 13)), (rep("Sensitive", 5)), "Highly sensitive")

knitr::kable(MFV_Ranked, caption = "Table 7.1. Salt tolerance ranking based on MFV mean from 8 variables identified by PCA", align="c")
```


#### (8) Dendogram
```{r, fig.cap = "Figure 8.1. The MFV dendogram based on 8 variables identified by PCA"}
#table with MFV from 8 important variables of PCA
important_var <- na.omit(MFV)
important_var <- MFV[c(1:7, 15)]

#make the dendogram
dend <- important_var %>% # change MFV_Ranked with important_var in function of professor answer 
  scale %>% 
  dist(method = "euclidean") %>% 
  hclust(method = "ward.D2") %>% 
  as.dendrogram %>%
  set("branches_k_color", 
      value = c("red", "orange","blue", "green"), 
      k = 4)

#plot dendogram
dend %>% plot(main = "MFV Dendrogram")
```
#### (9) Accessions map




### Discussion 
####From your objectives.
The priliminary results, despite being slightly different from that in the article produced the ranking that corresponds to the groups (Highly tolerant - Highly sensitive) outlined in the article. 








### Conclusions
The analysis is not yet completed, so conclusions will be drawn later.








